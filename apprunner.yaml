# apprunner.yaml - AWS App Runner設定ファイル
version: 1.0
runtime: docker

build:
  commands:
    build:
      - echo "🏀 NBA Analytics Dashboard をビルド中..."
      - echo "Python バージョン確認"
      - python --version
      - echo "依存関係インストール"
      - pip install --upgrade pip
      - pip install -r requirements.txt
      - echo "✅ ビルド完了"

run:
  runtime-version: latest
  command: streamlit run app.py --server.port=8080 --server.address=0.0.0.0 --server.headless=true --server.runOnSave=false --server.allowRunOnSave=false
  network:
    port: 8080
    env: PORT
  env:
    # App Runner用環境変数
    - name: PORT
      value: "8080"
    - name: STREAMLIT_SERVER_PORT
      value: "8080"
    - name: STREAMLIT_SERVER_ADDRESS
      value: "0.0.0.0"
    - name: STREAMLIT_SERVER_HEADLESS
      value: "true"
    - name: STREAMLIT_BROWSER_GATHER_USAGE_STATS
      value: "false"
    # パフォーマンス最適化
    - name: PYTHONUNBUFFERED
      value: "1"
    - name: PYTHONDONTWRITEBYTECODE
      value: "1"
    # App Runner識別用
    - name: DEPLOYMENT_ENV
      value: "AWS_APP_RUNNER"